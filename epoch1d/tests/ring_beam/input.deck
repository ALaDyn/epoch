begin:constant
  background_density = 1e20
  background_temp = 1e8
  ion_mass_e = 1836.2
  mass_ion = me * ion_mass_e
  ring_beam_energy_ev = 1.0e6
  pring_beam = sqrt(2 * mass_ion * qe * ring_beam_energy_ev)
  theta = -pi/3
  ! -2.005E-20 ! but with obviously change if anything above is changed
  pbeam = pring_beam * sin(theta)
  ! 1.158E-20 ! but with obviously change if anything above is changed
  pring = pring_beam * cos(theta)
  temp_beam_ev = ring_beam_energy_ev / 20
  temp_ring_ev = ring_beam_energy_ev / 100
  lambda_db = sqrt(epsilon0 * kb * background_temp / background_density / qe^2)
  grid_spacing = lambda_db * 0.5
  nxgrid = 1024
  x_length = nxgrid * grid_spacing
  simtime = grid_spacing / c
  diagtime = simtime * 2
  pdfn_limit = 2 * abs(pring_beam)
end:constant


begin:control
  nx = nxgrid
  npart = nx * 1000

  # final time of simulation
  t_end = simtime

  # size of domain
  x_min = 0.0
  x_max = nx * grid_spacing
end:control

begin:fields
  by = 1.0
end:fields

begin:boundaries
  bc_x_min = periodic
  bc_x_max = periodic
end:boundaries


begin:species
  name = ion_ring_beam
  charge = 1.0
  mass = ion_mass_e
  frac = 1.0
  density = 1.0e20
# the drift_x parameter is hijacked for the ring drift / width
  drift_x = pring
# the drift_z parameter is hijacked for the beam drift
  drift_z = pbeam
# the temp_x parameter is hijacked for the ring temperature
  temp_x_ev = temp_ring_ev
# the temp_z parameter is hijacked for the beam temperature
  temp_z_ev = temp_beam_ev
  sampling_function = ring_beam
end:species


begin:output
  # number of timesteps between output dumps
  dt_snapshot = diagtime
  # Number of dt_snapshot between full dumps
  full_dump_every = 100
  force_final_to_be_restartable = T

  # Properties at particle positions
  particles = full
  particle_weight = full

  # Properties on grid
  grid = always
  ex = always
  ey = always
  ez = always
  by = always
  bz = always
  ekbar = always
  charge_density = full
  number_density = always + species

  #Extended IO
  distribution_functions = always
end:output


begin:dist_fn
  name = px_py
  ndims = 2

  direction1 = dir_px
  direction2 = dir_py

  # range is ignored for spatial coordinates
  range1 = (-pdfn_limit, pdfn_limit)
  range2 = (-pdfn_limit, pdfn_limit)

  # resolution is ignored for spatial coordinates
  resolution1 = 100
  resolution2 = 100

  include_species:ion_ring_beam
end:dist_fn

begin:dist_fn
  name = px_pz
  ndims = 2

  direction1 = dir_px
  direction2 = dir_pz

  # range is ignored for spatial coordinates
  range1 = (-pdfn_limit, pdfn_limit)
  range2 = (-pdfn_limit, pdfn_limit)

  # resolution is ignored for spatial coordinates
  resolution1 = 100
  resolution2 = 100

  include_species:ion_ring_beam
end:dist_fn


begin:dist_fn
  name = py_pz
  ndims = 2

  direction1 = dir_py
  direction2 = dir_pz

  # range is ignored for spatial coordinates
  range1 = (-pdfn_limit, pdfn_limit)
  range2 = (-pdfn_limit, pdfn_limit)

  # resolution is ignored for spatial coordinates
  resolution1 = 100
  resolution2 = 100

  include_species:ion_ring_beam
end:dist_fn


begin:dist_fn
  name = px
  ndims = 1

  direction1 = dir_px

  # range is ignored for spatial coordinates
  range1 = (-pdfn_limit, pdfn_limit)

  # resolution is ignored for spatial coordinates
  resolution1 = 100

  include_species:ion_ring_beam
end:dist_fn

begin:dist_fn
  name = py
  ndims = 1

  direction1 = dir_py

  # range is ignored for spatial coordinates
  range1 = (-pdfn_limit, pdfn_limit)

  # resolution is ignored for spatial coordinates
  resolution1 = 100

  include_species:ion_ring_beam
end:dist_fn

begin:dist_fn
  name = pz
  ndims = 1

  direction1 = dir_pz

  # range is ignored for spatial coordinates
  range1 = (-pdfn_limit, pdfn_limit)

  # resolution is ignored for spatial coordinates
  resolution1 = 100

  include_species:ion_ring_beam
end:dist_fn
